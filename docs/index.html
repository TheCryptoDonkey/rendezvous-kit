<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>rendezvous-kit ‚Äî Interactive Demo</title>
  <link rel="stylesheet" href="https://unpkg.com/maplibre-gl@4/dist/maplibre-gl.css">
  <link rel="stylesheet" href="style.css?v=1.11.4">
</head>
<body>
  <header>
    <div class="header-left">
      <h1>rendezvous-kit</h1>
      <p class="tagline">Fair meeting points for everyone</p>
    </div>
    <nav class="tabs">
      <button class="tab active" data-tab="showcase">Showcase</button>
      <button class="tab" data-tab="interactive">Interactive</button>
    </nav>
    <div class="header-right">
      <span id="credit-balance" class="credit-badge hidden" title="Remaining routing credits (sats)"></span>
      <a id="version-badge" class="version-badge" href="https://www.npmjs.com/package/rendezvous-kit" target="_blank" rel="noopener"></a>
      <button id="theme-toggle" class="theme-toggle" title="Toggle light/dark mode">‚òÄÔ∏è</button>
      <a href="https://www.npmjs.com/package/rendezvous-kit" target="_blank" rel="noopener">npm</a>
      <a href="https://github.com/TheCryptoDonkey/rendezvous-kit" target="_blank" rel="noopener">GitHub</a>
    </div>
  </header>

  <main>
    <div id="map"></div>
    <aside id="panel">
      <section id="showcase-panel" class="controls">
        <div class="control-group">
          <label for="scenario-picker">Scenario</label>
          <select id="scenario-picker">
            <option value="bristol">Bristol Meetup</option>
            <option value="london">London Spread</option>
            <option value="edinburgh">Edinburgh Walk</option>
            <option value="east-midlands">East Midlands Drive</option>
            <option value="severn-estuary">Severn Estuary</option>
            <option value="lake-district">Lake District Cycle</option>
            <option value="thames-estuary">Thames Estuary</option>
            <option value="manchester">Manchester Group</option>
          </select>
        </div>
        <div class="control-group">
          <span class="control-group-label">Transport</span>
          <div id="mode-display" class="mode-badge"></div>
        </div>
        <div class="control-group">
          <label for="fairness-picker">Fairness strategy</label>
          <select id="fairness-picker">
            <option value="min_max">min_max</option>
            <option value="min_total">min_total</option>
            <option value="min_variance">min_variance</option>
          </select>
          <span id="fairness-desc" class="control-hint">Minimise worst-case travel time</span>
        </div>
      </section>

      <section id="interactive-panel" class="controls hidden">
        <div class="control-group">
          <span class="control-group-label">Participants</span>
          <div id="participant-list">
            <span class="control-hint">Click the map to place 2‚Äì5 markers</span>
          </div>
        </div>
        <div class="control-group">
          <span class="control-group-label">Transport</span>
          <div class="mode-buttons">
            <button class="mode-btn active" data-mode="drive">üöó Drive</button>
            <button class="mode-btn" data-mode="cycle">üö≤ Cycle</button>
            <button class="mode-btn" data-mode="walk">üö∂ Walk</button>
          </div>
        </div>
        <div class="control-group">
          <label for="time-slider">Time budget</label>
          <div class="slider-row">
            <input type="range" id="time-slider" min="5" max="60" value="15" step="1">
            <span id="time-value">15 min</span>
          </div>
        </div>
        <div class="control-group">
          <span class="control-group-label">Venue types</span>
          <div class="venue-checkboxes">
            <label><input type="checkbox" value="cafe" checked> Cafe</label>
            <label><input type="checkbox" value="restaurant"> Restaurant</label>
            <label><input type="checkbox" value="park"> Park</label>
            <label><input type="checkbox" value="pub" checked> Pub</label>
          </div>
        </div>
        <div class="control-group">
          <label for="interactive-fairness">Fairness strategy</label>
          <select id="interactive-fairness">
            <option value="min_max">min_max</option>
            <option value="min_total">min_total</option>
            <option value="min_variance">min_variance</option>
          </select>
          <span id="interactive-fairness-desc" class="control-hint">Minimise worst-case travel time</span>
        </div>
        <button id="btn-find" class="btn-find" disabled>Find rendezvous</button>
        <button id="btn-clear" class="btn-clear">Clear all</button>
        <div id="interactive-error" class="error-message hidden" role="alert"></div>
        <div id="payment-panel" class="payment-panel hidden"></div>
      </section>

      <section class="pipeline">
        <h3>Pipeline</h3>
        <div class="pipeline-steps">
          <div class="step" id="step-isochrones">
            <span class="step-icon">‚óã</span>
            <span class="step-label">Isochrones</span>
            <span class="step-count"></span>
          </div>
          <div class="step" id="step-intersection">
            <span class="step-icon">‚óã</span>
            <span class="step-label">Intersection</span>
            <span class="step-count"></span>
          </div>
          <div class="step" id="step-venues">
            <span class="step-icon">‚óã</span>
            <span class="step-label">Venues</span>
            <span class="step-count"></span>
          </div>
          <div class="step" id="step-scored">
            <span class="step-icon">‚óã</span>
            <span class="step-label">Scored</span>
          </div>
        </div>
      </section>

      <section class="results">
        <h3>Results</h3>
        <div id="results-list"></div>
      </section>
    </aside>
  </main>

  <footer>
    <details id="code-panel">
      <summary>Show code</summary>
      <pre><code id="code-content"></code></pre>
    </details>
  </footer>

  <script src="https://unpkg.com/maplibre-gl@4/dist/maplibre-gl.js"></script>
  <script>
    // Intercept fetch BEFORE ES modules load (modules capture globals at init)
    // to read credit/free-tier headers from toll-booth responses
    (function() {
      var VALHALLA = 'https://routing.trotters.cc';
      var orig = window.fetch;
      window.fetch = function() {
        return orig.apply(this, arguments).then(function(res) {
          var url = typeof arguments[0] === 'string' ? arguments[0] : (arguments[0] && arguments[0].url) || '';
          if (url.indexOf(VALHALLA) === 0) {
            var credit = res.headers.get('X-Credit-Balance');
            var free = res.headers.get('X-Free-Remaining');
            if (credit !== null) window._creditUpdate && window._creditUpdate('sats', parseInt(credit, 10));
            else if (free !== null) window._creditUpdate && window._creditUpdate('free', parseInt(free, 10));
          }
          return res;
        });
      };
    })();
  </script>
  <script type="module" src="demo.js?v=1.11.4"></script>
</body>
</html>
